<!--todo etwas anzeigen wenn keine comments vorhanden-->

<div class="comment-block-container" *ngIf="comment$ | async; let commentObject">
	<div class="main-comment-container" *ngIf="author$ | async; let author">
		<a class="comment-image-container" routerLink="/members/{{author.id}}">
			<img class="comment-image" [ngClass]="{'dummy': dummy}"
				 memoUserPreview [user]="author"
				 src="{{author.images[0]}}"/>
		</a>
		<div class="comment-container">
			<div class="comment-header">
				<div class="comment-header-info">
					<memo-profile-link class="comment-author-name" [user]="author"></memo-profile-link>

					<div class="comment-timestamp secondary-text"
						 title="{{commentObject.timeStamp | moment:'DD.MM.YYYY HH:mm:ss'}}">
						{{commentObject.timeStamp.fromNow()}}
					</div>
				</div>
			</div>
			<div class="comment-body">
				<!--todo directive that transforms @Username mentions to links?-->
				{{commentObject.content}}

				<div class="dummy-comment-text secondary-text" *ngIf="dummy">

				</div>
			</div>
			<div class="comment-footer" [ngClass]="{'dummy': dummy}">
				<span (click)="replyToComment(commentObject)">ANTWORTEN</span>
			</div>
		</div>

		<!--todo edit => inline editing-->
		<div class="comment-options"
			 [style.visibility]="((loggedInUser$ | async)?.id === author.id && !dummy) ? 'visible' : 'hidden'"
			 [ngClass]="{'show-element': isTouchDevice()}">

			<mat-icon
				[matMenuTriggerFor]="menu">
				more_horiz
			</mat-icon>

			<mat-menu #menu="matMenu" xPosition="before">
				<button mat-menu-item type="button" (click)="editComment(commentObject)">
					<mat-icon>edit</mat-icon>
					<span>Bearbeiten</span>
				</button>
				<button mat-menu-item type="button" (click)="deleteCurrentComment()">
					<mat-icon>delete</mat-icon>
					<span>LÃ¶schen</span>
				</button>
			</mat-menu>
		</div>
	</div>

	<div class="reply-form-container child-comments-container"
		 *ngIf="loggedInUser !== null && showReplyBox && !dummy && !showChildren">
		<memo-comment-input (submitComment)="addComment($event, commentObject.id)"
							(closeSubmitComment)="showReplyBox = false"
							[author]="loggedInUser"
							[focus]="true"
							[commentText]="''">

		</memo-comment-input>
	</div>

	<div class="child-comments-container" *ngFor="let children of [children$ | async]">
		<div class="show-children-button-container" *ngIf="children?.length > 0">
			<span (click)="showChildren = !showChildren; showReplyBox = showChildren ? showReplyBox : false">
				<span *ngIf="!showChildren; else hideChildren">
					Zeige {{children?.length}} Antwort{{children?.length > 1 ? 'en' : ''}}
				</span>
				<ng-template #hideChildren>
					<span>Verstecke {{children?.length}} Antwort{{children?.length > 1 ? 'en' : ''}}</span>
				</ng-template>
			</span>
		</div>
		<div *ngIf="showChildren">
			<div>
				<memo-comment-block *ngFor="let child of children; trackBy:trackCommentBy"
									[parentId]="commentObject.id"
									[eventId]="eventId"
									(onDelete)="deleteChildComment($event)"
									(onAddComment)="addComment($event.commentText, $event.parentCommentId)"
									[comment]="child"></memo-comment-block>

				<ng-template [ngIf]="loadingChildren">
					<memo-comment-block
						[parentId]="commentObject.id"
						[comment]="dummyComment"
						[dummy]="true"
					>

					</memo-comment-block>
				</ng-template>

				<div class="reply-form-container" *ngIf="loggedInUser !== null && showReplyBox">
					<memo-comment-input (submitComment)="addComment($event, commentObject.id)"
										(closeSubmitComment)="showReplyBox = false"
										[author]="loggedInUser"
										[focus]="true"
										[commentText]="''">

					</memo-comment-input>
				</div>
			</div>
		</div>
	</div>

</div>
